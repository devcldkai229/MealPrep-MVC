@model MealPrep.Web.ViewModels.DashboardVm
@{
    ViewData["Title"] = "B·∫£ng ƒêi·ªÅu Khi·ªÉn";
}

<div class="d-flex align-items-end justify-content-between mb-3">
    <div>
        <h3 class="fw-bold mb-1">Ch√†o m·ª´ng tr·ªü l·∫°i üëã</h3>
        <div class="text-secondary">Qu·∫£n l√Ω m√≥n ƒÉn, ƒëƒÉng k√Ω v√† theo d√µi dinh d∆∞·ª°ng m·ªçi n∆°i.</div>
    </div>
    <div class="d-flex gap-2">
        <a class="btn btn-primary" asp-controller="Subscription" asp-action="Create">ƒêƒÉng K√Ω</a>
        <a class="btn btn-outline-secondary" asp-controller="NutritionLog" asp-action="Create">Th√™m Nh·∫≠t K√Ω</a>
    </div>
</div>

<div class="row g-3">
    <div class="col-md-4">
        <div class="app-card p-3">
            <div class="kpi-title">ƒêƒÉng K√Ω</div>
            <div class="kpi-value mt-1">@Model.SubscriptionStatus</div>
            <div class="mt-2"><span class="chip">L·ªëi s·ªëng nƒÉng ƒë·ªông</span></div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="app-card p-3">
            <div class="kpi-title">Giao H√†ng Ti·∫øp Theo</div>
            <div class="kpi-value mt-1">@Model.NextDeliveryText</div>
            <div class="mt-2"><a class="link-muted" asp-controller="Subscription" asp-action="Create">Qu·∫£n l√Ω ƒëƒÉng k√Ω ‚Üí</a></div>
        </div>
    </div>

    <div class="col-md-4">
        <div class="app-card p-3">
            <div class="kpi-title">Calo H√¥m Nay</div>
            <div class="kpi-value mt-1">@Model.TodayCalories kcal</div>
            <div class="mt-2"><a class="link-muted" asp-controller="NutritionLogs" asp-action="Index">Xem dinh d∆∞·ª°ng ‚Üí</a></div>
        </div>
    </div>
</div>

<div class="row g-3 mt-1">
    <div class="col-lg-8">
        <div class="app-card p-3">
            <div class="d-flex justify-content-between align-items-center mb-2">
                <h5 class="fw-semibold mb-0">M√≥n ƒÇn N·ªïi B·∫≠t</h5>
                <a class="link-muted" asp-controller="Meals" asp-action="Index">Xem t·∫•t c·∫£ ‚Üí</a>
            </div>

            <div class="row g-3">
                @foreach (var m in Model.FeaturedMeals)
                {
                    <div class="col-md-6 col-xl-4">
                        <div class="app-card p-2">
                            <div class="meal-thumb mb-2"></div>
                            <div class="px-1 pb-1">
                                <div class="fw-semibold">@m.Name</div>
                                <div class="meal-meta">@m.Calories kcal ‚Ä¢ P @m.Protein ‚Ä¢ C @m.Carbs ‚Ä¢ F @m.Fat</div>
                                <div class="d-flex justify-content-between align-items-center mt-2">
                                    <div class="fw-semibold">@m.Price.ToString("C")</div>
                                    <a class="btn btn-sm btn-outline-secondary" asp-controller="Meals" asp-action="Details" asp-route-id="@m.Id">Xem</a>
                                </div>
                            </div>
                        </div>
                    </div>
                }
            </div>
        </div>
    </div>

    <div class="col-lg-4">
        <div class="app-card p-3 mb-3">
            <h5 class="fw-semibold">Thao T√°c Nhanh</h5>
            <div class="d-grid gap-2">
                <a class="btn btn-outline-secondary" asp-controller="Meals" asp-action="Index">Xem m√≥n ƒÉn</a>
                <a class="btn btn-outline-secondary" asp-controller="Subscription" asp-action="Create">T·∫°o ƒëƒÉng k√Ω</a>
                <a class="btn btn-outline-secondary" asp-controller="NutritionLogs" asp-action="Create">Th√™m nh·∫≠t k√Ω</a>
            </div>
        </div>

        <div class="app-card p-3">
            <h5 class="fw-semibold mb-2">Calo 7 Ng√†y Qua</h5>
            <div class="small text-secondary mb-2">Xu h∆∞·ªõng tu·∫ßn n√†y (b·∫£ng).</div>

            <table class="table table-sm mb-0">
                <thead>
                    <tr><th>Ng√†y</th><th class="text-end">kcal</th></tr>
                </thead>
                <tbody>
                @if (Model.WeekCalories.Count == 0)
                {
                    <tr><td colspan="2" class="text-secondary">Ch∆∞a c√≥ nh·∫≠t k√Ω.</td></tr>
                }
                else
                {
                    foreach (var d in Model.WeekCalories)
                    {
                        <tr>
                            <td>@d.Date.ToString("dd/MM")</td>
                            <td class="text-end">@d.Calories</td>
                        </tr>
                    }
                }
                </tbody>
            </table>
        </div>
    </div>
</div>

<div class="app-card p-3 mt-3">
    <div class="d-flex justify-content-between align-items-center mb-2">
        <h5 class="fw-semibold mb-0">ƒê∆°n H√†ng G·∫ßn ƒê√¢y</h5>
        <span class="text-secondary small">5 ƒë∆°n g·∫ßn nh·∫•t</span>
    </div>

    <table class="table mb-0">
        <thead>
            <tr>
                <th>Ng√†y</th>
                <th>Khung Gi·ªù</th>
                <th>Tr·∫°ng Th√°i</th>
                <th>M√≥n ƒÇn</th>
            </tr>
        </thead>
        <tbody>
        @if (Model.RecentOrders.Count == 0)
        {
            <tr><td colspan="4" class="text-secondary">Ch∆∞a c√≥ ƒë∆°n h√†ng.</td></tr>
        }
        else
        {
            foreach (var o in Model.RecentOrders)
            {
                <tr>
                    <td>@o.DeliveryDate.ToString("dd/MM/yyyy")</td>
                    <td>@o.DeliverySlot?.Name</td>
                    <td>@o.Status</td>
                    <td class="text-secondary">@string.Join(", ", o.Items.Select(i => $"{i.Meal?.Name} x{i.Quantity}"))</td>
                </tr>
            }
        }
        </tbody>
    </table>
</div>
